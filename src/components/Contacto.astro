---
const coords = { lat: -34.9277725, lng: -58.609375, zoom: 17 };
---

<section id="CONTACTO" class="scroll-mt-16 py-2 sm:py-4 bg-[var(--bp-bg-alt)]">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="grid gap-10 lg:grid-cols-2 items-stretch">
      <!-- Mapa (slide-in más lento) -->
      <div
        class="rounded-2xl overflow-hidden ring-1 ring-[var(--bp-border)] shadow-sm bg-[var(--bp-surface)] reveal reveal--slide"
        style="--delay: 80ms"
      >
        <div
          id="bp-map"
          class="aspect-[16/10] w-full"
          data-lat={coords.lat}
          data-lng={coords.lng}
          data-zoom={coords.zoom}
        />
      </div>

      <!-- Datos (fade-up escalonado más lento) -->
      <div class="flex flex-col justify-center">
        <h2
          class="text-2xl md:text-3xl font-extrabold tracking-tight text-[var(--bp-ink)] reveal"
          style="--delay: 0ms"
        >
          Contacto
        </h2>

        <div
          class="mt-6 flex flex-wrap gap-3 reveal"
          style="--delay: 200ms"
        >
          <a
            href="/reservar"
            class="inline-flex items-center gap-2 rounded-xl px-5 py-3 font-semibold text-[#111] bg-[var(--bp-accent)] hover:bg-[var(--bp-accent-600)] shadow-sm"
          >
            Reservar
          </a>
          <a
            id="bp-directions"
            class="inline-flex items-center gap-2 rounded-xl px-5 py-3 font-semibold text-white bg-[var(--bp-primary)] hover:bg-[var(--bp-primary-600)] shadow-sm"
            target="_blank"
            rel="noopener"
          >
            Cómo llegar
          </a>
        </div>

        <ul class="mt-6 space-y-3">
          <li class="reveal" style="--delay: 320ms">
            <p class="text-base md:text-xl font-extrabold tracking-tight text-[var(--bp-ink)]">
              Dirección
            </p>
            <p class="text-[var(--bp-ink)] mt-3 text-xl">
              Cam. Real Presbítero González y Aragón S/N, Ezeiza
            </p>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script is:inline src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script is:inline>
    // ===== Animaciones con IntersectionObserver (50% visible + más lento) =====
    (() => {
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (prefersReduced) return;

      const els = document.querySelectorAll('.reveal');
      const io = new IntersectionObserver(
        (entries) => {
          for (const entry of entries) {
            if (entry.isIntersecting && entry.intersectionRatio >= 0.5) {
              entry.target.classList.add('in');
              io.unobserve(entry.target);
            }
          }
        },
        { threshold: 0.5 } // 50% visible
      );
      els.forEach((el) => io.observe(el));
    })();
  </script>

  <script is:inline>
    // ===== Mapa Leaflet =====
    (function () {
      if (!window.L) return;
      const el = document.getElementById('bp-map');
      if (!el) return;

      const lat  = parseFloat(el.dataset.lat);
      const lng  = parseFloat(el.dataset.lng);
      const zoom = parseInt(el.dataset.zoom || '16', 10);
      const COMO_LLEGAR = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;

      const map = L.map(el, { zoomControl: true, scrollWheelZoom: false }).setView([lat, lng], zoom);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      const pin = L.divIcon({
        className: 'bp-pin-wrap',
        html: '<div class="bp-pin"></div>',
        iconSize: [26, 26],
        iconAnchor: [13, 13],
        popupAnchor: [0, -14]
      });

      const marker = L.marker([lat, lng], { icon: pin }).addTo(map);
      marker.bindPopup(`
        <strong>Estacionamiento Blue Parking</strong><br/>
        Cam. Real Presbítero González y Aragón S/N, Ezeiza<br/>
        <a href="${COMO_LLEGAR}" target="_blank" rel="noopener">Cómo llegar</a>
      `);

      const dir = document.getElementById('bp-directions');
      if (dir) dir.href = COMO_LLEGAR;

      map.on('click', () => map.scrollWheelZoom.enable());
    })();
  </script>

  <style is:global>
    /* ===== Pin del mapa ===== */
    .bp-pin {
      position: relative;
      width: 26px; height: 26px; border-radius: 9999px;
      background: var(--bp-primary);
      border: 3px solid #fff;
      box-shadow: 0 0 0 4px color-mix(in srgb, var(--bp-primary) 35%, transparent);
    }
    .bp-pin::after {
      content: "";
      position: absolute; inset: -6px; border-radius: 9999px;
      box-shadow: 0 0 0 0 rgba(29,87,168,.35);
      animation: bp-pulse 2.2s ease-out infinite; /* un toque más lenta */
    }
    @keyframes bp-pulse {
      0%   { box-shadow: 0 0 0 0   rgba(29,87,168,.35); }
      70%  { box-shadow: 0 0 0 14px rgba(29,87,168,0); }
      100% { box-shadow: 0 0 0 0   rgba(29,87,168,0); }
    }

    /* ===== Reveals (más lentas) ===== */
    @media (prefers-reduced-motion: no-preference) {
      .reveal {
        opacity: 0;
        transform: translateY(10px) scale(.985);
        transition:
          opacity 1s ease,                                   /* antes .6s */
          transform 1s cubic-bezier(.22,.65,.2,1);           /* antes .6s */
        transition-delay: var(--delay, 0ms);
        will-change: transform, opacity;
      }
      .reveal--slide {
        transform: translateX(64px); /* un poco más de distancia al inicio */
      }
      .reveal.in {
        opacity: 1;
        transform: none;
      }
    }
  </style>
</section>
